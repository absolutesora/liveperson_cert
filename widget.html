<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Page</title>
</head>
<body>

    <h1>Hello World</h1>

    <div id="chat"></div>
    

    <script type="text/javascript">
    lpTag.agentSDK.init()

    var chat = document.getElementById("chat");
    var info = "chatTranscript.lines";
    var api = "f93eff30"

    // var getData = function(data){
    //     console.log("success");
    //     var lastItem = data[data.length -1];
    //     console.log(lastItem.text);
    //     chat.innerText = lastItem.text;
    // }

    var updateCallback = function(data){
        console.log("success", data);
        var latest = data.newValue[data.newValue.length-1].text;
        console.log(latest);
        fetch(`https://www.omdbapi.com/?apikey=${api}&t=${latest}`)
            .then(function (response){
                return response.json();
            })
            .then(function(movie){
                console.log(movie);
                chat.innerHTML = `<p>Title:</p>${movie.Title}<br>${movie.Actors}<br>${movie.Year}`;
            });
        
    };

    var onError = function(err){
        if(!err){
            console.log("successfully bind to conversation");
        }
    };

    lpTag.agentSDK.bind(info, updateCallback, onError);
    </script>

</body>
</html>